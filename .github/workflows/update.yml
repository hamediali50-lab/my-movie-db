name: RedMovie Auto Updater

on:
  schedule:
    # Ù‡Ø± 30 Ø¯Ù‚ÛŒÙ‚Ù‡ ÛŒÚ©Ø¨Ø§Ø± Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯
    - cron: '*/30 * * * *'
  workflow_dispatch: # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ (Ø¯Ú©Ù…Ù‡ Run)

jobs:
  scrape-and-update:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write # Ø§Ø¬Ø§Ø²Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm install

    - name: Run Scraper Bot
      env:
        # Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù…Ù† Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯
        DB_SECRET: ${{ secrets.DB_SECRET }}
      run: node scraper-bot.js

    - name: Commit and Push changes
      run: |
        git config --global user.name "RedMovie Bot"
        git config --global user.email "bot@redmovie.com"
        
        # Ø§Ú¯Ø± ØªØºÛŒÛŒØ±ÛŒ Ø¯Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨ÙˆØ¯ØŒ Ø¢Ù† Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
        if [[ -n $(git status -s) ]]; then
          git add updates.json archive.enc
          git commit -m "ğŸš€ Auto-update: New content added"
          git push
        else
          echo "No changes to commit."
        fi
